<!DOCTYPE html>
<html lang="vi">
<head>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin qu·∫£n l√Ω kh√≥a h·ªçc</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #e0f7fa, #f1f8e9);
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 40px;
    }
    form {
      background: #ffffff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 40px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #37474f;
    }
    input,
    select,
    textarea {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }
    button[type="submit"] {
      background-color: #00796b;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button[type="submit"]:hover {
      background-color: #004d40;
    }
    .list-section {
      background: #ffffff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    .list-section h2 {
      margin-bottom: 24px;
      color: #2e7d32;
      border-bottom: 2px solid #66bb6a;
      padding-bottom: 8px;
    }
    .khuvuc-block {
      margin-bottom: 30px;
    }
    .khuvuc-block h3 {
      font-size: 20px;
      margin-bottom: 12px;
      color: #388e3c;
    }
    .course-item {
      background-color: #f1f8e9;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .course-item .info {
      max-width: 75%;
    }
    .course-item .info strong {
      font-size: 16px;
      color: #2e7d32;
    }
    .course-item .info span {
      display: block;
      font-size: 13px;
      color: #616161;
    }
    .btn-delete {
      background-color: #e53935;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn-delete:hover {
      background-color: #b71c1c;
    }
  </style>
</head>
<body>

<h1>Trang qu·∫£n l√Ω kh√≥a h·ªçc</h1>

<form id="formAddCourse">
  <label for="selectKhuVuc">Ch·ªçn khu v·ª±c</label>
  <select id="selectKhuVuc" required></select>

  <label for="inputTen">T√™n kh√≥a h·ªçc</label>
  <input type="text" id="inputTen" required placeholder="Nh·∫≠p t√™n kh√≥a h·ªçc" />

  <label for="inputMoTa">M√¥ t·∫£ kh√≥a h·ªçc</label>
  <textarea id="inputMoTa" required placeholder="Nh·∫≠p m√¥ t·∫£ kh√≥a h·ªçc"></textarea>

  <label for="inputGia">Gi√° kh√≥a h·ªçc (VND)</label>
  <input type="number" id="inputGia" required min="0" placeholder="Nh·∫≠p gi√° kh√≥a h·ªçc" />

  <label for="inputHinh">Link h√¨nh ·∫£nh minh h·ªça (URL)</label>
  <input type="text" id="inputHinh" placeholder="https://example.com/image.jpg" />

  <button type="submit">Th√™m kh√≥a h·ªçc</button>
</form>

<section class="list-section">
  <h2>C√°c kh√≥a h·ªçc hi·ªán c√≥</h2>
  <div id="listKhoaHoc"></div>
</section>

<script>
  // ======== PH·∫¶N B·∫¢O V·ªÜ M·∫¨T KH·∫®U ============
  const PASSWORD = "lamlam2802"; // üîê M·∫≠t kh·∫©u b·∫°n c√≥ th·ªÉ thay ƒë·ªïi t·∫°i ƒë√¢y

  function checkPassword() {
    const input = prompt("üîê Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ truy c·∫≠p trang admin:");
    if (input !== PASSWORD) {
      alert("‚ùå M·∫≠t kh·∫©u sai. Quay v·ªÅ trang ch·ªß.");
      window.location.href = "/"; // C√≥ th·ªÉ ƒë·ªïi th√†nh URL b·∫°n mu·ªën
    }
  }
  // checkPassword();

  // ======== ADMIN FUNCTIONALITY =============
  
  const SUPABASE_URL = "https://sdixqzzpggcxrbtaqqtf.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNkaXhxenpwZ2djeHJidGFxcXRmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2MDQ4OTMsImV4cCI6MjA2NDE4MDg5M30.5nP_A5N6Jb2fDDNmRVcLva_znbrQhErt-xcpmm5V6S8";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  
  const danhSachKhuVuc = [
    "Kh√≥a Combo", "To√°n", "L√Ω", "Ti·∫øng Anh", "Sinh", "VƒÉn", "S·ª≠", "ƒê·ªãa",
    "DGNL (HSA)", "VATC - APT", "DGTD (TSA)", "TOEIC", "IELTS", "ƒê·∫°i h·ªçc"
  ];

  const selectKhuVuc = document.getElementById("selectKhuVuc");
  const formAddCourse = document.getElementById("formAddCourse");
  const listKhoaHocDiv = document.getElementById("listKhoaHoc");

  async function loadKhoaHoc() {
    const { data, error } = await supabase.from("khoahoc").select("*");
    if (error) {
      alert("‚ùå L·ªói t·∫£i kh√≥a h·ªçc: " + error.message);
      return [];
    }
    return data;
  }

  function taoOptionKhuVuc() {
    danhSachKhuVuc.forEach(kv => {
      const option = document.createElement("option");
      option.value = kv;
      option.textContent = kv;
      selectKhuVuc.appendChild(option);
    });
  }
    async function hienThiDanhSachKhoaHoc() {
      const data = await loadKhoaHoc();
      listKhoaHocDiv.innerHTML = "";

      if (data.length === 0) {
        listKhoaHocDiv.innerHTML = `<p style="font-style: italic; color: #666;">Ch∆∞a c√≥ kh√≥a h·ªçc n√†o.</p>`;
        return;
      }

      danhSachKhuVuc.forEach(khuvuc => {
        const khoaHocKhu = data.filter(kh => kh.loai === khuvuc);
        if (khoaHocKhu.length === 0) return;

        const block = document.createElement("div");
        block.className = "khuvuc-block";

        const h3 = document.createElement("h3");
        h3.textContent = khuvuc;
        block.appendChild(h3);

        khoaHocKhu.forEach(kh => {
          const item = document.createElement("div");
          item.className = "course-item";

          const info = document.createElement("div");
          info.className = "info";
          info.innerHTML = `
            <strong>${kh.ten}</strong>
            <span>M√¥ t·∫£: ${kh.moTa}</span>
            <span>Gi√°: ${kh.gia} VND</span>
          `;

          const btnXoa = document.createElement("button");
          btnXoa.className = "btn-delete";
          btnXoa.textContent = "X√≥a";
          btnXoa.onclick = () => {
            if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kh√≥a h·ªçc "${kh.ten}" kh√¥ng?`)) {
              xoaKhoaHoc(kh.id);
            }
          };

          item.appendChild(info);
          item.appendChild(btnXoa);
          block.appendChild(item);
        });

        listKhoaHocDiv.appendChild(block);
      });
    }

    formAddCourse.addEventListener("submit", async e => {
      e.preventDefault();

      const ten = document.getElementById("inputTen").value.trim();
      const moTa = document.getElementById("inputMoTa").value.trim();
      const gia = document.getElementById("inputGia").value.trim();
      const loai = selectKhuVuc.value;
      const hinh = document.getElementById("inputHinh").value.trim() || '';

      const { error } = await supabase.from("khoahoc").insert([{ ten, moTa, gia, loai, hinh }]);

      if (error) {
        alert("‚ùå L·ªói th√™m kh√≥a h·ªçc: " + error.message);
        return;
      }

      alert("‚úÖ ƒê√£ th√™m kh√≥a h·ªçc th√†nh c√¥ng!");
      formAddCourse.reset();
      selectKhuVuc.selectedIndex = 0;
      hienThiDanhSachKhoaHoc();
    });

    async function xoaKhoaHoc(id) {
      const { error } = await supabase
        .from("khoahoc")
        .delete()
        .eq("id", id);

      if (error) {
        alert("‚ùå L·ªói khi x√≥a: " + error.message);
      } else {
        alert("‚úÖ ƒê√£ x√≥a kh√≥a h·ªçc th√†nh c√¥ng!");
        hienThiDanhSachKhoaHoc(); // C·∫≠p nh·∫≠t l·∫°i danh s√°ch
      }
    }

  taoOptionKhuVuc();
  hienThiDanhSachKhoaHoc();
</script>

</body>
</html>
